# Decred 闪电网络的革命

![logo](img/ln/header.jpg )

### 什么是闪电网络

闪电网络（Lightning Network）简称LN，是一个去中心化的系统。闪电网络的卓越之处在于，无需信任对方或第三方即可实现实时的海量交易。闪电网络起源于比特币的扩容问题，闪电网络是状态通道的典型应用。也是一个分布式网络，同时利用区块链的特性消除将资金托管给第三方带来的风险。主要作为用于即时、高容量的微支付。闪电网络的目的是实现安全的链下交易，其本质上是使用了哈希时间锁定智能合约来安全地进行0确认交易的一种机制，通过设置巧妙的‘智能合约’，完善链下通道，使得用户可以在闪电网络上进行0确认交易。

###闪电网络能解决什么问题

* 解决区块扩容问题
* 支付慢，手续费高，难以小额交易
* 无法大面积普及

### 核心概念

RSMC（RecoverableSequence Maturity Contract）和 HTLC（Hashed Timelock Contract）。RSMC 保障了两个人之间的直接交易可以在链下完成，解决了通道中代币单向流动问题，HTLC解决了代币跨节点传递的问题。这两个类型的交易组合构成了闪电网络。保障了任意两个人之间的转账都可以通过一条“支付”通道来完成。从而实现任意两个人都可以在链下完成交易。

### 工作原理

这里我就不给大家发一些技术性的解释了，网上有很多技术性的解释，有兴趣的可以查阅一下。今天我举个简单易懂的例子，比如A每天都要在包子铺买早餐，但是A觉的每天都用加密货币结算太麻烦，到账速度慢，而且每天都产生手续费。手续费甚至比包子的价格还要高，所以A决定和商店老板B说能不能在你这里挂个帐月底结算，老板B说不行说一旦你跑了怎么办。老板B说你可以预付给我一个月的钱然后我给你记账，A也觉得不妥。最后两人决定找一个箱子，然后A把币放在箱子里，箱子里上了两把锁，只有A和B同时有钥匙才能打开，A和B有一个共同的账本，每一笔交易都会记录在账本上，每一笔交易只要双方签个字就能确认这笔交易，只要箱子里的钱还够这个支付就会一直进行下去。

这是相当于形成了上面说的链下通道，全部是链下进行的，只有最后结算的时候才会放到主链上结算，计入区块。从头到尾只有两条信息是计入公链上的，一个是将币放在箱子里的锁币信息，还有一个就是结算时候的信息。

闪电网络真正厉害的地方是利用这种通道让没有建立关系的两个人建立通道，假设有ABC三个人，A和B之间有通道，B和C之间有通道，A想要把币转给C，就可以通过B，但是其中产生了信用问题，如果B在中间把钱拿跑了怎么办，为了解决这种问题，闪电网络引用了链下暗语，相当于公钥私钥。A把箱子给B，箱子上带有A设定的暗语，B是无法拿出来，当B把箱子发给C后，A会把暗语告诉给C，这样C就能拿到箱子里的币了。

### Decred闪电网络的发展

Decred创始人JakeYocom-Piatt 于2017年5月23日发布于blog.decred.org 的一篇文章，主要介绍 闪电网络及 Decred 决定采纳的原因。主要有以下几点：

* **低延时支付** - 货币的主要功能就是支付，Decred希望成为好的支付货币，就一定要解决支付问题，目前的加密货币难以用于日常生活主要是因为支付慢，手续费高，难以小额交易等问题。通过支付LN这个技术，有望能在商业模式下有用武之地。
* **延期结算** - 通过LN技术可以大大降低链上的交易存储量，有助于数据库的存储。
* **增强隐私** - 大家都知道整个链上的交易都是公开透明的，任何用户都可以得到区块的交易信息，通过LN技术交易只会记录中间的节点，也就是我上述说的箱子，而不会记录链下的交易过程，是对隐私的重大改进。
* **跨链原子交换** - 如果一个商家只收取比特币的话，你没有比特币就比较麻烦。在LN技术改善下可以实现原子互换，可以直接用Decred在线下直接兑换成其他数字货币，会让以后的支付变得非常的方便快捷，而且避免费用的产生。

基于上述考量，LN 具有非常大的益处。但是，用户必须了解 LN 存在的弱点：

* **节点的中心化** - LN技术可以通过不同的节点和任何人建立交易关系，如果您打算运行一个繁忙的中间 LN 节点，该节点有许多向其他节点开放的渠道，则您必须锁定一些币才能与各个交易对手开通渠道。交易所应该会变成非常大的交易节点，因为很多人可能更愿意和交易所这种机构来建立通道，这样整个网络才会铺的很大很广。为了有效地节点管理，将会在这里鼓励中心化。
* **交易对手盗窃** - 由于在链下进行 LN 交易，支付渠道（payment channel) 中的交易对手可能试图窃取渠道中的资金，但这只有在特定条件下才会发生并且是可预防的。传统的链上交易不存在这个问题，因为它们直接被写入区块链，而区块链是不可篡改的账本

### 低延时支付

加密货币需要在区块链中定期创建区块，从而将等待确认交易有效所花费的平均时间限制降得更低。区块之间的平均时间范围可以是 10 秒到 10 分钟，具体取决于加密货币种。Decred 的平均区块时间为 5 分钟。在 Decred 情况下，对于大多数销售点应用程序（例如：餐馆、酒吧、零售企业）来说，链上交易确认所花费的时间太长了，且这还是假设链上交易没有积货的情况下。在保持所有交易为链上交易的情况下，修正这个问题的唯一选择是大幅缩短平均区块时间，但这仍然无法解决链上交易拥堵的情况。

通过支持 LN，我们为 Decred 开通了即时微支付，这意味着 Decred 可以被具有实体零售业务的商家所接受。除了将类似于现有法币银行付款方式的体验重现之外，链下付款不会出现与链上付款一样的拥堵问题。在没有 LN 支持的情况下，除非客户和商家都可以接受 “我们现在必须坐在这里等几分钟” 的用户体验，否则 Decred 不会成为实用的付款方式。更通俗的说，LN 的低延时允许 Decred 与多种商业模型进行整合。

### 延期结算

银行定期使用净额结算流程，以尽量减少银行与其交易对手之间的交易数量。典型过程包括在给定的交易日内，收取银行 A 到银行 B 的所有外向付款，这会将从银行 A 到银行 B 的数千个外部付款合并成一个单一付款。通过延迟银行间的结算，银行间交易的数量大幅减少。 LN 中的支付渠道是具有有限值的延期结算路径。尽管双向流动的金额都有上限，该结算路径非常类似于银行之间发生的净结算过程。这意味着可能会有成千上万的 LN 交易，且其对应的链上交易只有几个。

与银行执行净结算以简化银行间转账和节省费用一样，LN 可减少链上交易的数量，并相应地降低费用。非必要时，应避免在链上存储数据，这会使用户避免相关的交易费用。所有区块链都由某种交易数据库支持，并且随着该数据库中的记录数量增加，数据库的性能开始降级。 LN 将减少链上交易的数量，这有助于最小化数据库记录计数的增长率。

### 增强隐私

有一个运作中的区块链的前提是用户必须能够下载其区块，意这味着任何用户可得到这些区块中的交易信息。即使使用能保护隐私的加密货币，单个交易也必须存储在公共可用的区块中。对于 LN，交易可以完全下链，因此不存在与该交易相对应的公共数据。 LN 交易的唯一记录是在发送者和接收人之间转发该交易的中间 LN 节点 ，这与公共可用的情况相比，对隐私保护有了重大改进。

### 跨链原子交换

任何持有加密货币的人都知道在购买货币流程中对中心化交易所有多大依赖。只处理加密货币的交易所不太容易出现问题，但它们仍然以中心化为主。如果交易所必须停止其部分或全部业务，它会对其交易的加密货币的价值产生非常严重的影响。去中心化交易所确实存在，但它们依靠资金托管和决策人。

添加 LN 支持，将允许进行链上和链下原子交换，这意味着可以进行无信任跨链交换。这里需要注意的是，Decred 和交易对手链都必须支持 LN 才能进行交换。如果不需要较低的结算等待时间，那么链上原子交换会有良好效果，如果需要较少的等待时间，则可以使用链下原子交换。这些交换仅限于加密货币之间，所以当涉及法币时，这种技术将不起作用。通过跨链原子交换创造流动性将降低与交易 Decred 相关的相对风险。

### 交易方盗窃

建立 LN 支付渠道需要一方或双方进行链上交易并交换一些额外的信息来使渠道初始化。由于 LN 交易在链下进行，因此它们并不是不可篡改，而是通过智能合约精心构建的。在这智能合约里，如果不诚实的一方尝试从渠道窃取资金，诚实的一方将获得渠道资金作为窃取方的惩罚。虽然渠道中的资金有可能被盗用，但 LN 交易争对这种情况提供了内置的保护，并且要窃取资金，就需要有能力防止对方采取的链上“违规补救”（breach remedy）交易。这种盗窃情况只能发生在链上交易特别拥堵或矿工共同勾结不验证违规补救交易的情况下，考虑到大多数付款渠道将只包含少量币，这两种情况很少发生。

### 节点的中心化 

传输 LN 交易的网络与1层加密货币使用的网络是分开的，这意味着 LN 节点与 1 层加密货币节点是分开的。对最终用户（如消费者或商家）来说，运行 LN 节点的要求非常低。您只需要启动节点，然后资助一个渠道，它的 LN 节点必须拥有良好的连接性， 然后就设置好了。如果您打算运行一个忙碌的中间 LN 节点，该节点有许多向其他节点开放的渠道，则您必须锁定一些币才能与各个交易对手开通渠道。在充当中间 LN 节点时，要求具有““切肤之痛” (skin in the game) ”的好处在于它能够激励有效的节点管理，但它也可能在未来产生巨大障碍，因为操作中间 LN 节点的相对成本变高了。

### 结论
由于 LN 不会破坏任何现有功能，反而只会增加Decred作为价值存储和传输系统的功能，因此对于Decred而言，这是一个非常具有吸引力的附加功能。 LN 是迄今为止我所见过的智能合约中最直接有用的应用，因为它有助于实现低延时链下交易，这允许与现有的法币付款方式直接竞争。当然LN现在也还有很多需要解决的技术难题，也有很多人对LN技术提出了质疑，例如安全，没有给节点提供经济动力之类的。但我相信LN技术不管是对于Decred也好还是整个行业也好，意义和推动都将是非同凡响的，也是Decred成为普及的支付货币必须迈出的一步。

作者： DCR无双社区、Stephen、Hugo <br/>
校对： DCR 中文社区 <br/>
原文： https://medium.com/decred/lightning-network-in-practice-3352377cf0dc